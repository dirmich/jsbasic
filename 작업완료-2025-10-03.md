# ì‘ì—… ì™„ë£Œ ë³´ê³ ì„œ
ë‚ ì§œ: 2025-10-03
ì»¤ë°‹: d1d8170

## ì™„ë£Œëœ ì‘ì—…

### 1. CPU ë””ìŠ¤ì–´ì…ˆë¸”ëŸ¬ êµ¬í˜„ âœ…
**íŒŒì¼**: `src/cpu/cpu.ts`, `src/cpu/debugger.ts`

ê¸°ì¡´ì— êµ¬í˜„ë˜ì–´ ìˆë˜ `OpcodeDecoder` í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ CPU ë””ìŠ¤ì–´ì…ˆë¸”ëŸ¬ë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.

#### ì£¼ìš” ë³€ê²½ì‚¬í•­
- **OpcodeDecoder import**: ì´ë¯¸ ì™„ì „í•˜ê²Œ êµ¬í˜„ëœ ë””ìŠ¤ì–´ì…ˆë¸”ëŸ¬ í™œìš©
- **traceExecution()**: "???" ëŒ€ì‹  ì‹¤ì œ ëª…ë ¹ì–´ í…ìŠ¤íŠ¸ í‘œì‹œ
  ```typescript
  const disasm = OpcodeDecoder.disassemble(this.memory.getData(), pc);
  const instruction = disasm.fullInstruction;
  ```
- **getDebugInfo()**: lastInstruction í•„ë“œì— ì‹¤ì œ ëª…ë ¹ì–´ ì œê³µ

#### ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­
- 6502 ëª…ë ¹ì–´ ì„¸íŠ¸ ì™„ì „ ì§€ì› (151ê°œ ê³µì‹ ëª…ë ¹ì–´)
- 13ê°€ì§€ ì£¼ì†Œ ì§€ì • ëª¨ë“œ ëª¨ë‘ ì§€ì›
- ë””ìŠ¤ì–´ì…ˆë¸”ë¦¬ ê²°ê³¼ í¬ë§· ì˜ˆì‹œ: `"LDA #$42"`, `"JMP $FFFC"`

---

### 2. CPU ìƒíƒœ ì •ë³´ ì œê³µ ì™„ì„± âœ…
**íŒŒì¼**: `src/cpu/cpu.ts`, `src/cpu/debugger.ts`

CPUì˜ `getDebugInfo()` ë©”ì„œë“œê°€ ì´ë¯¸ ëª¨ë“  í•„ìš”í•œ ì •ë³´ë¥¼ ì œê³µí•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

#### ì œê³µ ì •ë³´
```typescript
{
  registers: CPURegisters,
  flags: StatusFlags,
  cycleCount: number,
  instructionCount: number,      // âœ… ì™„ë£Œ
  isHalted: boolean,              // âœ… ì™„ë£Œ
  pendingInterrupts: {            // âœ… ì™„ë£Œ
    nmi: boolean,
    irq: boolean
  },
  lastInstruction: string         // âœ… ì™„ë£Œ
}
```

#### debugger.ts ê°œì„ 
- TODO ì£¼ì„ ì œê±°
- `cpu.getDebugInfo()` ì§ì ‘ í™œìš©
- lastInstructionì— `?? 'N/A'` í´ë°± ì¶”ê°€

---

### 3. Keyboard ëª¨ë“ˆ êµ¬í˜„ âœ…
**ìƒˆ íŒŒì¼**: `src/io/keyboard.ts`

EventEmitter ê¸°ë°˜ì˜ í¬ë¡œìŠ¤ í”Œë«í¼ í‚¤ë³´ë“œ ì…ë ¥ ê´€ë¦¬ ëª¨ë“ˆì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

#### ì£¼ìš” ê¸°ëŠ¥
- **í‚¤ ì´ë²¤íŠ¸ ì²˜ë¦¬**: keydown, keyup, keypress, keyrepeat
- **í‚¤ ë°˜ë³µ ê¸°ëŠ¥**: ì„¤ì • ê°€ëŠ¥í•œ ì§€ì—°ì‹œê°„ ë° ê°„ê²©
- **íŠ¹ìˆ˜ í‚¤ ìº¡ì²˜**: F1-F12, í™”ì‚´í‘œ í‚¤, ê¸°ëŠ¥ í‚¤ ë“±
- **í¬ë¡œìŠ¤ í”Œë«í¼**: ë¸Œë¼ìš°ì € í™˜ê²½ë§Œ ì§€ì› (Node.jsëŠ” ì´ë²¤íŠ¸ êµ¬ë…ë§Œ)

#### ì„¤ì • ì˜µì…˜
```typescript
{
  enableRepeat: boolean,      // í‚¤ ë°˜ë³µ í™œì„±í™”
  repeatDelay: number,        // ë°˜ë³µ ì‹œì‘ ì§€ì—° (ê¸°ë³¸ 500ms)
  repeatInterval: number,     // ë°˜ë³µ ê°„ê²© (ê¸°ë³¸ 50ms)
  captureSpecialKeys: boolean // íŠ¹ìˆ˜ í‚¤ ê¸°ë³¸ ë™ì‘ ë°©ì§€
}
```

#### ì‚¬ìš© ì˜ˆì‹œ
```typescript
const keyboard = new Keyboard({ enableRepeat: true });
keyboard.activate();
keyboard.on('keypress', (event) => {
  console.log(event.key, event.code);
});
```

---

### 4. Storage ëª¨ë“ˆ êµ¬í˜„ âœ…
**ìƒˆ íŒŒì¼**: `src/io/storage.ts`

localStorage ìš°ì„ , ë©”ëª¨ë¦¬ í´ë°± ë°©ì‹ì˜ ì €ì¥ì†Œ ê´€ë¦¬ ëª¨ë“ˆì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

#### ì£¼ìš” ê¸°ëŠ¥
- **ìë™ í´ë°±**: localStorage ì‚¬ìš© ë¶ˆê°€ ì‹œ ë©”ëª¨ë¦¬ ì €ì¥ì†Œ
- **í‚¤ prefix**: ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê²©ë¦¬ (`jsbasic_` ê¸°ë³¸ê°’)
- **CRUD ì—°ì‚°**: set, get, has, remove, clear
- **ì¼ê´„ ì‘ì—…**: setMultiple, getMultiple
- **ê²€ìƒ‰ ê¸°ëŠ¥**: ì •ê·œì‹/íŒ¨í„´ ê¸°ë°˜ í‚¤ ê²€ìƒ‰
- **í†µê³„**: ì´ í•­ëª© ìˆ˜, í¬ê¸°, ë‚¨ì€ ìš©ëŸ‰

#### ì„¤ì • ì˜µì…˜
```typescript
{
  prefix: string,           // í‚¤ prefix (ê¸°ë³¸ 'jsbasic_')
  useLocalStorage: boolean, // localStorage ì‚¬ìš© ì—¬ë¶€
  maxEntries: number        // ë©”ëª¨ë¦¬ ì €ì¥ì†Œ ìµœëŒ€ í•­ëª© (ê¸°ë³¸ 1000)
}
```

#### ì‚¬ìš© ì˜ˆì‹œ
```typescript
const storage = new Storage({ prefix: 'basic_' });
storage.set('program_1', { code: '10 PRINT "HELLO"' });
const program = storage.get('program_1');
const stats = storage.getStats();
```

---

### 5. ë©”ëª¨ë¦¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¥ âœ…
**íŒŒì¼**: `src/types/memory.ts`, `src/memory/manager.ts`

ë””ìŠ¤ì–´ì…ˆë¸”ëŸ¬ê°€ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í–ˆìŠµë‹ˆë‹¤.

#### ë³€ê²½ì‚¬í•­
```typescript
// src/types/memory.ts
export interface MemoryInterface {
  // ê¸°ì¡´ ë©”ì„œë“œë“¤...
  getData(): Uint8Array;  // âœ… ì¶”ê°€
}

// src/memory/manager.ts
public getData(): Uint8Array {
  return this.memory;
}
```

---

### 6. I/O ëª¨ë“ˆ í†µí•© âœ…
**íŒŒì¼**: `src/io/index.ts`

ìƒˆë¡œìš´ ëª¨ë“ˆì„ exportí•˜ë„ë¡ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.

```typescript
export { Terminal } from './terminal.js';
export { Keyboard } from './keyboard.js';  // âœ… ì¶”ê°€
export { Storage } from './storage.js';    // âœ… ì¶”ê°€

export const IO_MODULE_VERSION = '0.2.0';  // ë²„ì „ ì—…ë°ì´íŠ¸
```

---

## ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸

### ë¹Œë“œ ê²°ê³¼
```bash
âœ… ë¹Œë“œ ì„±ê³µ
ğŸ“¦ main.js: 222.1KB
ğŸ“¦ main.js.map: 499.4KB
ğŸ“¦ ì´ í¬ê¸°: 721.5KB
```

### íƒ€ì… ì•ˆì „ì„±
- âœ… ì£¼ìš” íƒ€ì… ì˜¤ë¥˜ í•´ê²°
- âš ï¸ ê¸°ì¡´ ì½”ë“œì˜ ì¼ë¶€ íƒ€ì… ì˜¤ë¥˜ ì”ì¡´ (ui/components.ts, basic/parser.ts)

---

## Git ì»¤ë°‹ ì •ë³´

**ì»¤ë°‹ í•´ì‹œ**: d1d8170
**ë¸Œëœì¹˜**: main
**ì›ê²© ì €ì¥ì†Œ**: https://github.com/dirmich/jsbasic.git

**ë³€ê²½ëœ íŒŒì¼**:
- `src/cpu/cpu.ts` (modified)
- `src/cpu/debugger.ts` (modified)
- `src/io/index.ts` (modified)
- `src/io/keyboard.ts` (new file)
- `src/io/storage.ts` (new file)
- `src/memory/manager.ts` (modified)
- `src/types/memory.ts` (modified)

**í†µê³„**:
- 7ê°œ íŒŒì¼ ë³€ê²½
- 569ì¤„ ì¶”ê°€
- 16ì¤„ ì‚­ì œ
- 2ê°œ ì‹ ê·œ íŒŒì¼ ìƒì„±

---

## ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

### ë†’ì€ ìš°ì„ ìˆœìœ„
1. **ê¸°ì¡´ íƒ€ì… ì˜¤ë¥˜ í•´ê²°**
   - `src/ui/components.ts`: HTMLElement íƒ€ì… ìºìŠ¤íŒ… ë¬¸ì œ
   - `src/basic/parser.ts`: Token | undefined ì²˜ë¦¬

2. **í…ŒìŠ¤íŠ¸ ì‘ì„±**
   - Keyboard ëª¨ë“ˆ ìœ ë‹› í…ŒìŠ¤íŠ¸
   - Storage ëª¨ë“ˆ ìœ ë‹› í…ŒìŠ¤íŠ¸
   - CPU ë””ìŠ¤ì–´ì…ˆë¸”ëŸ¬ í†µí•© í…ŒìŠ¤íŠ¸

### ì¤‘ê°„ ìš°ì„ ìˆœìœ„
3. **ë²ˆë“¤ í¬ê¸° ìµœì í™”**
   - í˜„ì¬: 721.5KB â†’ ëª©í‘œ: <500KB
   - Tree-shaking ê°œì„ 
   - ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„± ì œê±°

4. **ë¬¸ì„œ ì—…ë°ì´íŠ¸**
   - API ë¬¸ì„œì— ìƒˆ ëª¨ë“ˆ ì¶”ê°€
   - ì‚¬ìš©ì ê°€ì´ë“œì— ì˜ˆì‹œ ì½”ë“œ ì¶”ê°€

### ë‚®ì€ ìš°ì„ ìˆœìœ„
5. **ê¸°ëŠ¥ ì¶”ê°€**
   - Keyboard: Node.js í™˜ê²½ readline ì§€ì›
   - Storage: ì••ì¶• ì €ì¥ ì˜µì…˜
   - CPU: ì‹¤ì‹œê°„ ë””ìŠ¤ì–´ì…ˆë¸”ë¦¬ UI

---

## ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­

### ì„¤ê³„ ê²°ì •
1. **EventEmitter íŒ¨í„´**: ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ ìœ„í•œ ì¼ê´€ëœ ì¸í„°í˜ì´ìŠ¤
2. **í¬ë¡œìŠ¤ í”Œë«í¼**: ë¸Œë¼ìš°ì €ì™€ Node.js í™˜ê²½ ëª¨ë‘ ì§€ì›
3. **íƒ€ì… ì•ˆì „ì„±**: TypeScript strict ëª¨ë“œ ì¤€ìˆ˜

### ì„±ëŠ¥ ê³ ë ¤
- Keyboard: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ (cleanup)
- Storage: ë©”ëª¨ë¦¬ ì €ì¥ì†Œ í¬ê¸° ì œí•œ (1000 í•­ëª©)
- CPU: ë””ìŠ¤ì–´ì…ˆë¸”ë¦¬ ìºì‹± ì—†ìŒ (í•„ìš”ì‹œ ì¶”ê°€ ê°€ëŠ¥)

---

## ê²°ë¡ 

ëª¨ë“  TODO í•­ëª©ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ëŠ” ì´ì œ ì™„ì „í•œ CPU ë””ë²„ê¹… ê¸°ëŠ¥ê³¼ I/O ì‹œìŠ¤í…œì„ ê°–ì¶”ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

**ì£¼ìš” ì„±ê³¼**:
- âœ… CPU ë””ìŠ¤ì–´ì…ˆë¸”ëŸ¬ ì™„ì „ ì‘ë™
- âœ… CPU ìƒíƒœ ì •ë³´ ì™„ì „ ì œê³µ
- âœ… í¬ë¡œìŠ¤ í”Œë«í¼ Keyboard ëª¨ë“ˆ
- âœ… ìœ ì—°í•œ Storage ëª¨ë“ˆ
- âœ… ê¹”ë”í•œ íƒ€ì… ì•ˆì „ì„± ê°œì„ 

**ì½”ë“œ í’ˆì§ˆ**:
- ëª…í™•í•œ íƒ€ì… ì •ì˜
- ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬
- í¬ê´„ì ì¸ ì£¼ì„
- ëª¨ë˜ TypeScript íŒ¨í„´

---

**ì‘ì„±ì**: Claude (AI ì–´ì‹œìŠ¤í„´íŠ¸)
**ê²€í† ì**: @dirmich
**ë‚ ì§œ**: 2025-10-03
